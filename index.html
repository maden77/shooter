<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Egg Shooter Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#a855f7">
    
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/528/528076.png">
    
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>

    <style>
        body { 
            background: #050515; 
            margin: 0; 
            overflow: hidden; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            color: white; 
        }
        canvas { display: block; touch-action: none; }

        /* UI Containers */
        #setup, #gameover { 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            background: rgba(10, 10, 30, 0.95); 
            padding: 25px; 
            border-radius: 20px; 
            border: 2px solid #a855f7; 
            text-align: center; 
            width: 80%; 
            max-width: 300px; 
            z-index: 100; 
            box-shadow: 0 0 20px rgba(168, 85, 247, 0.4);
        }

        .hidden { display: none !important; }

        input { 
            padding: 12px; 
            border-radius: 10px; 
            border: 1px solid #a855f7; 
            background: #1a1a3a; 
            color: white; 
            width: 80%; 
            margin-bottom: 15px;
            outline: none;
        }

        button { 
            padding: 12px 25px; 
            background: #a855f7; 
            color: white; 
            border: none; 
            border-radius: 10px; 
            font-weight: bold; 
            cursor: pointer;
            transition: 0.3s;
        }

        button:hover { background: #9333ea; }

        /* PWA Install Banner */
        #install-prompt {
            position: fixed; 
            bottom: 20px; 
            left: 50%; 
            transform: translateX(-50%);
            background: #a855f7; 
            padding: 15px; 
            border-radius: 12px;
            z-index: 2000; 
            text-align: center; 
            width: 85%; 
            max-width: 400px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        #scoreBox {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 20px;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            pointer-events: none;
        }
    </style>
</head>
<body>

    <div id="scoreBox">Score: <span id="scoreVal">0</span></div>

    <div id="setup">
        <h2 style="color: #FFD700;">Egg Shooter</h2>
        <input type="text" id="nick" placeholder="Nama Kamu" maxlength="10">
        <button onclick="startGame()">MAIN SEKARANG</button>
    </div>

    <div id="gameover" class="hidden">
        <h2 style="color: #ff4444;">GAME OVER</h2>
        <p id="finalScore"></p>
        <button onclick="location.reload()">COBA LAGI</button>
    </div>

    <div id="install-prompt" class="hidden">
        <p style="margin: 0 0 10px 0;">Install <b>Egg Shooter</b> di layar utama agar lebih ringan!</p>
        <button id="install-btn" style="background: white; color: #a855f7;">INSTALL</button>
        <button id="dismiss-install" style="background: transparent; color: white; border: none; margin-left: 10px;">Nanti</button>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script src="pwa.js"></script>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let play = false;

        // Atur ukuran canvas
        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        // Data Pemain
        let me = { 
            x: canvas.width/2, 
            y: canvas.height/2, 
            p: [], 
            a: 0, 
            score: 0, 
            n: "Player", 
            c: "#a855f7" 
        };
        
        let foods = [];
        let bots = [];
        const fruitImages = [];
        const fruitSources = [
            'https://cdn-icons-png.flaticon.com/512/528/528076.png', // Egg icon
            'https://cdn-icons-png.flaticon.com/512/2909/2909808.png' // Other icon
        ];

        // Load Gambar
        fruitSources.forEach(src => {
            const img = new Image();
            img.src = src;
            fruitImages.push(img);
        });

        function startGame() {
            const nickInput = document.getElementById('nick').value;
            if(nickInput) me.n = nickInput;
            document.getElementById('setup').classList.add('hidden');
            
            // Inisialisasi awal
            me.p = Array(10).fill({x: me.x, y: me.y});
            for(let i=0; i<15; i++) spawnFood();
            for(let i=0; i<3; i++) spawnBot();
            
            play = true;
        }

        function spawnFood() {
            foods.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                imgIdx: Math.floor(Math.random() * fruitImages.length)
            });
        }

        function spawnBot() {
            bots.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                a: Math.random() * Math.PI * 2,
                p: Array(10).fill({x: 0, y: 0}),
                c: '#ff4444',
                n: "Bot Egg"
            });
        }

        function drawSnake(p, color, name) {
            ctx.strokeStyle = color;
            ctx.lineWidth = 15;
            ctx.lineCap = 'round';
            ctx.beginPath();
            p.forEach((pt, i) => {
                if(i === 0) ctx.moveTo(pt.x, pt.y);
                else ctx.lineTo(pt.x, pt.y);
            });
            ctx.stroke();
            ctx.fillStyle = "white";
            ctx.fillText(name, p[0].x - 10, p[0].y - 15);
        }

        // Kontrol Mouse/Touch
        canvas.addEventListener('mousemove', e => {
            if(!play) return;
            me.a = Math.atan2(e.clientY - me.y, e.clientX - me.x);
        });

        canvas.addEventListener('touchmove', e => {
            if(!play) return;
            const touch = e.touches[0];
            me.a = Math.atan2(touch.clientY - me.y, touch.clientX - me.x);
        }, {passive: false});

        function loop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if(play) {
                // Update Posisi Player
                me.x = (me.x + Math.cos(me.a) * 3 + canvas.width) % canvas.width;
                me.y = (me.y + Math.sin(me.a) * 3 + canvas.height) % canvas.height;
                me.p.unshift({x: me.x, y: me.y});
                me.p.pop();

                // Cek makan
                foods.forEach((f, i) => {
                    if(Math.hypot(me.x - f.x, me.y - f.y) < 20) {
                        foods.splice(i, 1);
                        spawnFood();
                        me.score += 10;
                        document.getElementById('scoreVal').innerText = me.score;
                        me.p.push({...me.p[me.p.length-1]}); // Tambah panjang
                    }
                });

                // Bot Logic & Render
                bots.forEach(b => {
                    b.a += (Math.random() - 0.5) * 0.2;
                    b.x = (b.p[0].x + Math.cos(b.a) * 2.5 + canvas.width) % canvas.width;
                    b.y = (b.p[0].y + Math.sin(b.a) * 2.5 + canvas.height) % canvas.height;
                    b.p.unshift({x: b.x, y: b.y});
                    b.p.pop();
                    drawSnake(b.p, b.c, b.n);

                    // Tabrakan dengan Bot
                    if(Math.hypot(me.x - b.x, me.y - b.y) < 15) {
                        play = false;
                        document.getElementById('gameover').classList.remove('hidden');
                        document.getElementById('finalScore').innerText = "Skor Akhir: " + me.score;
                    }
                });

                drawSnake(me.p, me.c, me.n);
            }

            // Render Makanan
            foods.forEach(f => {
                if(fruitImages[f.imgIdx].complete) {
                    ctx.drawImage(fruitImages[f.imgIdx], f.x-10, f.y-10, 20, 20);
                }
            });

            requestAnimationFrame(loop);
        }

        loop();
    </script>
</body>
</html>
