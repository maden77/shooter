<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
      <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icon2048-192x192.png" sizes="192x192">
    <title>Snake Master: Ultimate Infinite</title>
    <script>
    <style>
        :root { --neon: #00f2ff; --gold: #ffd700; --bg: #05050a; --danger: #ff0055; }
        body { margin: 0; background: var(--bg); overflow: hidden; font-family: 'Segoe UI', sans-serif; color: white; touch-action: none; }
        canvas { display: block; }

        /* --- UI OVERLAY --- */
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        .pointer { pointer-events: auto; }
        
        #stats-bar { position: absolute; top: 15px; left: 15px; display: flex; flex-direction: column; gap: 8px; }
        .box { background: rgba(0,0,0,0.8); padding: 8px 15px; border-radius: 12px; border: 1px solid var(--neon); font-size: 13px; width: fit-content; backdrop-filter: blur(5px); }

        .menu-btns { position: absolute; top: 100px; left: 15px; display: flex; flex-direction: column; gap: 10px; }
        button { background: rgba(255,255,255,0.1); border: 1px solid var(--neon); color: white; padding: 10px 15px; border-radius: 10px; font-weight: bold; cursor: pointer; pointer-events: auto; }
        button:active { background: var(--neon); color: black; }

        /* Joystick */
        #joy-base { position: absolute; bottom: 50px; left: 50px; width: 100px; height: 100px; background: rgba(255,255,255,0.05); border-radius: 50%; border: 2px solid rgba(0,242,255,0.2); }
        #joy-stick { position: absolute; top: 25px; left: 25px; width: 50px; height: 50px; background: var(--neon); border-radius: 50%; box-shadow: 0 0 15px var(--neon); opacity: 0.6; }

        /* Modals */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1000; display: flex; justify-content: center; align-items: center; }
        .modal-content { background: #0a0a1a; padding: 25px; border-radius: 20px; width: 85%; max-width: 350px; border: 2px solid var(--neon); text-align: center; }
        .hidden { display: none !important; }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        .card { background: #111; padding: 10px; border-radius: 10px; border: 1px solid #333; cursor: pointer; }
        .card.active { border-color: var(--neon); background: rgba(0,242,255,0.1); }
        
        input { padding: 12px; border-radius: 8px; border: 1px solid var(--neon); background: #111; color: white; width: 80%; margin: 10px 0; font-size: 18px; text-align: center; }
    </style>
</head>
<body>

    <div id="lobby" class="modal">
        <div class="modal-content">
            <h1 style="color:var(--neon); margin-bottom: 5px;">SNAKE MASTER</h1>
            <p style="font-size: 12px; color: #888; margin-bottom: 20px;">v2.0 Infinite World & Smart Bots</p>
                  
            
            
            <div id="main-menu">
    <input type="text" id="nameInput" placeholder="NAMA KAMU..." style="width:80%; margin-bottom:10px">
    
    <button style="width:100%; margin-bottom:10px" onclick="startGame('solo')">üë§ MAIN SOLO</button>
    <button style="width:100%; margin-bottom:10px" onclick="showMultiplayer()">üéÆ MABAR (WIFI)</button>
</div>


            <div id="multi-menu" class="hidden">
                <p>ID KAMU: <span id="my-id" style="color:var(--gold); font-weight:bold">....</span></p>
                <button style="width:100%" onclick="initHost()">üëë BUAT ROOM</button>
                <input type="number" id="join-id" placeholder="MASUKKAN ID TEMAN">
                <button style="width:100%" onclick="initJoin()">üîó GABUNG</button>
                <button style="margin-top:15px; background:none; border:none; color:#666" onclick="hideMultiplayer()">KEMBALI</button>
            </div>
        </div>
    </div>

    <div id="game-over" class="modal hidden">
        <div class="modal-content">
            <h2 style="color:var(--danger)">MODAR!</h2>
            <p id="final-score">Skor: 0</p>
            <button onclick="location.reload()">MAIN LAGI</button>
        </div>
    </div>

    <div id="shop" class="modal hidden">
        <div class="modal-content">
            <h3>TOKO SKIN</h3>
            <div id="skin-list" class="grid"></div>
            <button onclick="closeShop()">TUTUP</button>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div id="ui-layer">
        <div id="stats-bar">
            <div class="box">ü™ô Koin: <span id="ui-coins">0</span></div>
            <div class="box" style="border-color:var(--gold)">üìèüç∫üçªüç©üç´üç¨üçôüßÜü•òüçùüçîü•©üçñüßÄüçñüçÑ‚Äçüü´ Panjang: <span id="ui-len">15</span></div>
        </div>
        <div class="menu-btns">
            <button onclick="openShop()">üõí SKIN</button>
        </div>
        <div id="joy-base" class="pointer"><div id="joy-stick"></div></div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let viewport = { x: 0, y: 0 };
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // --- DATA & CONFIG ---
        let db = JSON.parse(localStorage.getItem('snake_db')) || { coins: 0, owned: ['#00f2ff'], active: '#00f2ff' };
        const skinOptions = [
            {n:"Cyan", c:"#00f2ff", p:0},
            {n:"Neon", c:"#ff0055", p:500},
            {n:"Gold", c:"#ffd700", p:2000},
            {n:"Toxic", c:"#39ff14", p:1000}
        ];
                   // --- SISTEM SUARA ---
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
              function playSound(type) {
    if (type === 'makan') {
        // Menggunakan link MP3 yang kamu berikan
        const audio = new Audio('https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3');
        audio.volume = 0.5; // Atur volume (0.0 sampai 1.0)
        audio.play().catch(e => console.log("Audio play diblokir browser:", e));
    } else if (type === 'mati') {
        // Efek suara mati (opsional, bisa diganti link lain)
        const deadAudio = new Audio('https://assets.mixkit.co/active_storage/sfx/2021/2021-preview.mp3');
        deadAudio.play().catch(e => {});
    }
}



                // --- ID & NAMA PERMANEN ---
        let myShortId = localStorage.getItem('cacingPlayerId');
        if (!myShortId) {
            myShortId = Math.floor(1000 + Math.random() * 9000).toString();
            localStorage.setItem('cacingPlayerId', myShortId);
        }

        class Snake {
            constructor(x, y, color, isBot = false) {
                this.segments = [];
                for(let i=0; i<15; i++) this.segments.push({x: x, y: y});
                this.color = color;
                this.angle = Math.random() * 6.28;
                this.speed = isBot ? 2.5: 4;
                this.radius = 12;
                this.isBot = isBot;
                this.alive = true;
            }

            update() {
                if(!this.alive) return;
                let head = this.segments[0];

                if(this.isBot) {
                    let target = this.getNearestFood(head);
                    if(target) {
                        let targetAngle = Math.atan2(target.y - head.y, target.x - head.x);
                        let diff = targetAngle - this.angle;
                        while(diff < -Math.PI) diff += Math.PI*2;
                        while(diff > Math.PI) diff -= Math.PI*2;
                        this.angle += diff * 0.1;
                    }
                }

                let newHead = {
                    x: head.x + Math.cos(this.angle) * this.speed,
                    y: head.y + Math.sin(this.angle) * this.speed
                };

                this.segments.unshift(newHead);
                this.segments.pop();
                this.checkCollisions();
            }

            getNearestFood(head) {
                let min = 400; let nearest = null;
                foods.forEach(f => {
                    let d = Math.hypot(f.x - head.x, f.y - head.y);
                    if(d < min) { min = d; nearest = f; }
                });
                return nearest;
            }

            checkCollisions() {
                let head = this.segments[0];
                // Player vs Bots
                if(!this.isBot) {
                    bots.forEach(b => {
                        if(!b.alive) return;
                        b.segments.forEach(seg => {
                            if(Math.hypot(head.x - seg.x, head.y - seg.y) < this.radius + b.radius) {
                                b.die(); // Bot hancur jika kamu tabrak sampingnya
                            }
                        });
                    });
                }
            }

            draw() {
                if(!this.alive) return;
                ctx.save();
                ctx.shadowBlur = 8; ctx.shadowColor = this.color;
                this.segments.forEach((s, i) => {
                    ctx.fillStyle = i === 0 ? "white" : this.color;
                    ctx.beginPath();
                    ctx.arc(s.x - viewport.x, s.y - viewport.y, this.radius, 0, Math.PI*2);
                    ctx.fill();
                });
                ctx.restore();
            }

            die() {
                this.alive = false;
                this.segments.forEach(s => foods.push({x: s.x, y: s.y, emoji: '‚ú®', val: 10}));
                if(!this.isBot) {
                    document.getElementById('final-score').innerText = "Skor: " + this.segments.length;
                    document.getElementById('game-over').classList.remove('hidden');
                } else {
                    setTimeout(() => {
                        let idx = bots.indexOf(this);
                        if(idx > -1) bots[idx] = new Snake(p1.segments[0].x + (Math.random()-0.5)*1500, p1.segments[0].y + (Math.random()-0.5)*1500, `hsl(${Math.random()*360},70%,50%)`, true);
                    }, 3000);
                }
            }
        }

        let p1 = new Snake(0, 0, db.active);
        let foods = []; let bots = []; let gameActive = false;
        let peer, conn;

        // --- CORE FUNCTIONS ---
    function startGame(mode) {
    // 1. Ambil dan validasi nama
    const name = document.getElementById('nameInput').value.trim();
    
    if (name === "") {
        alert("Woi, isi dulu namanya!");
        return; // Berhenti di sini jika nama kosong
    }

    // 2. Sembunyikan menu/lobby
    document.getElementById('lobby').classList.add('hidden');

    // 3. Inisialisasi dunia game
    for(let i=0; i<30; i++) spawnFood(true);
    
    // 4. Spawn bot (100 bot mungkin agak berat, pastikan performa aman)
    for(let i=0; i<100; i++) {
        bots.push(new Snake(
            (Math.random()-0.5)*2000, 
            (Math.random()-0.5)*2000, 
            `hsl(${Math.random()*360},70%,50%)`, 
            true
        ));
    }

    // 5. Aktifkan loop game
    gameActive = true;
    console.log("Memulai game sebagai: " + name);
    gameLoop();
}

       

        

        function spawnFood(init = false) {
            let x = init ? (Math.random()-0.5)*3000 : p1.segments[0].x + (Math.random()-0.5)*3000;
            let y = init ? (Math.random()-0.5)*3000 : p1.segments[0].y + (Math.random()-0.5)*3000;
            foods.push({x, y, emoji: ['üçé','üçâ','üçá','üçå','üçä','üåΩ','‚òï','ü•ù','üéÇ','üçà','üå∂Ô∏è',
                                      'üçç','üßÄ'][Math.floor(Math.random()*4)], val: 5});
        }

        function gameLoop() {
            if(!gameActive) return;
            ctx.fillStyle = "#05050a";
            ctx.fillRect(0,0,canvas.width, canvas.height);

            if(p1.alive) {
                viewport.x = p1.segments[0].x - canvas.width/2;
                viewport.y = p1.segments[0].y - canvas.height/2;
            }

            drawGrid();

            // Handle Foods
            ctx.font = "30px Arial";
            for(let i=foods.length-1; i>=0; i--) {
                let f = foods[i];
                ctx.fillText(f.emoji, f.x - viewport.x, f.y - viewport.y);
                
                // Makan
                if(p1.alive && Math.hypot(p1.segments[0].x - f.x, p1.segments[0].y - f.y) < 25) {
                    foods.splice(i, 1);
                    p1.segments.push({...p1.segments[p1.segments.length-1]});
                    db.coins += f.val; updateUI(); spawnFood();
                } else {
                    bots.forEach(b => {
                        if(b.alive && Math.hypot(b.segments[0].x - f.x, b.segments[0].y - f.y) < 25) {
                            foods.splice(i, 1);
                            b.segments.push({...b.segments[b.segments.length-1]});
                            spawnFood();
                        }
                    });
                }
            }

            p1.update(); p1.draw();
            bots.forEach(b => { b.update(); b.draw(); });

            requestAnimationFrame(gameLoop);
        }

        function drawGrid() {
            ctx.strokeStyle = "rgba(0,242,255,0.05)";
            let size = 100;
            let startX = Math.floor(viewport.x / size) * size;
            let startY = Math.floor(viewport.y / size) * size;
            for(let x=startX; x<startX+canvas.width+size; x+=size) {
                ctx.beginPath(); ctx.moveTo(x-viewport.x, 0); ctx.lineTo(x-viewport.x, canvas.height); ctx.stroke();
            }
            for(let y=startY; y<startY+canvas.height+size; y+=size) {
                ctx.beginPath(); ctx.moveTo(0, y-viewport.y); ctx.lineTo(canvas.width, y-viewport.y); ctx.stroke();
            }
        }

        // --- UI & CONTROLS ---
        let joyActive = false;
        document.getElementById('joy-base').addEventListener('touchstart', () => joyActive = true);
        window.addEventListener('touchmove', (e) => {
            if(!joyActive || !p1.alive) return;
            let t = e.touches[0];
            let r = document.getElementById('joy-base').getBoundingClientRect();
            let dx = t.clientX - (r.left + r.width/2), dy = t.clientY - (r.top + r.height/2);
            p1.angle = Math.atan2(dy, dx);
            let dist = Math.min(Math.sqrt(dx*dx+dy*dy), 40);
            document.getElementById('joy-stick').style.transform = `translate(${Math.cos(p1.angle)*dist}px, ${Math.sin(p1.angle)*dist}px)`;
        });
        window.addEventListener('touchend', () => { joyActive = false; document.getElementById('joy-stick').style.transform = `translate(0,0)`; });

        function updateUI() {
            document.getElementById('ui-coins').innerText = db.coins;
            document.getElementById('ui-len').innerText = p1.segments.length;
            localStorage.setItem('snake_db', JSON.stringify(db));
        }

        function openShop() {
            document.getElementById('shop').classList.remove('hidden');
            let list = document.getElementById('skin-list'); list.innerHTML = "";
            skinOptions.forEach(s => {
                let own = db.owned.includes(s.c);
                list.innerHTML += `<div class="card ${db.active==s.c?'active':''}" onclick="buySkin('${s.c}',${s.p})">
                    <div style="background:${s.c};width:25px;height:25px;border-radius:50%;margin:auto"></div>
                    <p style="font-size:11px;margin:5px 0">${s.n}<br>${own?'MILIK':'üí∞'+s.p}</p>
                </div>`;
            });
        }
        function buySkin(c, p) {
            if(db.owned.includes(c)) db.active = c;
            else if(db.coins >= p) { db.coins -= p; db.owned.push(c); db.active = c; }
            p1.color = db.active; updateUI(); openShop();
        }
        function closeShop() { document.getElementById('shop').classList.add('hidden'); }

        // --- MULTIPLAYER LOGIC ---
        function showMultiplayer() { 
            document.getElementById('main-menu').classList.add('hidden'); 
            document.getElementById('multi-menu').classList.remove('hidden');
            let id = Math.floor(1000 + Math.random()*9000);
            document.getElementById('my-id').innerText = id;
        }
        function hideMultiplayer() {
            document.getElementById('multi-menu').classList.add('hidden'); 
            document.getElementById('main-menu').classList.remove('hidden');
        }
        function initHost() {
            let id = document.getElementById('my-id').innerText;
            peer = new Peer('snake-'+id);
            peer.on('open', () => alert("Room Dibuat! Berikan ID ke teman."));
            peer.on('connection', (c) => { conn = c; startGame(); });
        }
        function initJoin() {
            let id = document.getElementById('join-id').value;
            peer = new Peer();
            peer.on('open', () => {
                conn = peer.connect('snake-'+id);
                conn.on('open', () => startGame());
            });
        }

        window.addEventListener('resize', () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; });
        updateUI();
         <script src="pwa.js"></script>
   <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js">
    </script>
</body>
</html>
